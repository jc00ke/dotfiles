#!/bin/env bash
set -eox pipefail
DIR="$(dirname "$(readlink -f "$0")")"

source "$DIR/_helpers.sh"

sudo apt install -y \
  autoconf \
  autopoint \
  bison \
  build-essential \
  cmake \
  curl \
  exuberant-ctags \
  fish \
  git \
  git-doc \
  git-gui \
  git-svn \
  gitg \
  gnome-calculator \
  gnome-clocks \
  gnome-weather \
  htop \
  imagemagick \
  inotify-tools \
  jq \
  libbz2-dev \
  libclang-dev libffi-dev \
  libfontconfig1-dev \
  libfreetype6-dev \
  libgdbm-dev \
  libgtk-3-dev \
  libncurses5-dev \
  libreadline-dev \
  libssl-dev \
  libtool \
  libxcb-xfixes0-dev \
  libxml2-dev \
  libxslt1-dev \
  libyaml-dev \
  nautilus \
  parallel \
  pkg-config \
  pspg \
  regolith-look-ayu-dark \
  zlib1g-dev

log "Updating the yadm repo origin URL"
yadm remote set-url origin "git@github.com:jc00ke/dotfiles.git"

chsh -s /usr/bin/fish

mkdir -p "$HOME/projects"
mkdir -p "$HOME/src"
cd "$HOME" || exit

source "$DIR/_install.sh"

log "Setting up 1Password"
curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/keyrings/1password-archive-keyring.gpg
echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/amd64 stable main' | sudo tee /etc/apt/sources.list.d/1password.list
sudo mkdir -p /etc/debsig/policies/AC2D62742012EA22/
curl -sS https://downloads.1password.com/linux/debian/debsig/1password.pol | sudo tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
sudo mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg

log "Setting up gh CLI"
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
  && sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
  && echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" \
  | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null

sudo apt update && sudo apt install 1password gh -y

# log "Installing Python deps for Neovim"
# echo "See: https://github.com/liuchengxu/vim-clap/issues/556#issuecomment-712867766"
# pip install neovim pyx
